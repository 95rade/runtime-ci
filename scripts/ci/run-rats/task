#!/bin/bash
set -xeu

export CONFIG
CONFIG="$PWD/integration-config/${CONFIG_FILE_PATH}"

CF_GOPATH=/go/src/github.com/cloudfoundry/

echo "Moving cf-routing-acceptance-tests onto the gopath..."
mkdir -p $CF_GOPATH
cp -R cf-routing-acceptance-tests $CF_GOPATH

cd /go/src/github.com/cloudfoundry/cf-routing-acceptance-tests

go install -v github.com/cloudfoundry/cf-routing-acceptance-tests/vendor/github.com/onsi/ginkgo/ginkgo

packages=("http_routes" "tcp_routing")
for i in "${packages[@]}"
do
  ginkgo -r "$i" \
    -slowSpecThreshold=120 \
    -keepGoing \
    -randomizeAllSpecs \
    -skipPackage=helpers \
    -slowSpecThreshold=120 \
    -nodes="${NODES}"
done
