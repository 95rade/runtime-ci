#!/bin/bash

set -xeu

function commit_terraform_state_file {
 git config user.name "CF MEGA BOT"
 git config user.email "cf-mega@pivotal.io"
 git add $1
 git commit -m "Update terraform state file"
 git push
}

pushd env-repo
  pushd terraform
    export GOOGLE_CREDENTIALS=$(cat google_credentials.json)
    set +x
    echo 'terraform apply'
    terraform apply
    echo 'commit_terraform_state_file'
    commit_terraform_state_file terraform.tfstate
    set -x
    popd

